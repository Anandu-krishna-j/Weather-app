<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather App</title>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            let locationName = document.querySelector("#placeName");
            let windSpeed = document.querySelector("#windSpeed");
            let temparature = document.querySelector("#temparature")

            async function sendLocationToServer() {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(async (position) => {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        console.log("here position", position);
                        try {
                            const response = await fetch(`/weather?lat=${lat}&lon=${lon}`, {
                                method: 'GET'
                            });
                            if (!response.ok) {
                                throw new Error('Network response was not ok');
                            }
                            const data = await response.json();
                            console.log(data);
                            if (data && data.name) {
                                locationName.innerHTML = data.name;
                                windSpeed.innerHTML = " Wind speed " +data?.wind?.speed;
                                temparature.innerHTML = " Temparature " +data?.main?.temp +" Â°C";
                            } else {
                                locationName.innerHTML = "No location name found";
                            }
                        } catch (err) {
                            console.error("Error fetching data:", err);
                            locationName.innerHTML = "Error fetching location data.";
                        }
                    }, (error) => {
                        console.error("Geolocation error:", error);
                        locationName.innerHTML = "Error getting location.";
                    });
                } else {
                    console.error('Geolocation is not supported by this browser.');
                    locationName.innerHTML = "Geolocation not supported.";
                }
            }

            // Call this function periodically or based on some event
            setInterval(sendLocationToServer, 3000); // Call every 10 seconds

            // Call the function immediately to get data without waiting for the interval
            // sendLocationToServer();
        });
    </script>
</head>
<style>
    *{
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    }
</style>
<body>
    <h1>Weather App</h1>
    <h1 id="placeName">Loading...</h1>
    <h4 id="windSpeed"></h4>
    <h4 id="temparature"></h4>
</body>
</html>
